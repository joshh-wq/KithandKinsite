---
---

<section class="signup" id="waitlist">
  <div class="container-narrow text-center">
    <h2>Be the first to know when we launch</h2>

    <form class="signup-form" id="signup-form">
      <div class="form-group">
        <input
          type="email"
          name="email"
          id="email"
          placeholder="you@example.com"
          required
        />
      </div>

      <div class="form-group checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" name="professional" id="professional" />
          <span>I'm a mental health professional</span>
        </label>
      </div>

      <button type="submit" class="btn btn-sage">
        Notify me
      </button>

      <p class="signup-note" id="form-message">
        Early supporters get <strong>$10 lifetime access</strong><br />
        <span class="text-muted">(Regular price: $20)</span>
      </p>
    </form>
  </div>
</section>

<style>
  .signup {
    background-color: var(--white);
    padding: var(--space-3xl) 0;
  }

  .signup h2 {
    margin-bottom: var(--space-lg);
  }

  .signup-form {
    max-width: 400px;
    margin: 0 auto;
  }

  .form-group {
    margin-bottom: var(--space-md);
  }

  .checkbox-group {
    display: flex;
    justify-content: center;
  }

  .signup-form .btn {
    width: 100%;
    margin-bottom: var(--space-md);
  }

  .signup-note {
    font-size: 0.9375rem;
    color: var(--text-muted);
    line-height: 1.5;
  }

  .signup-note strong {
    color: var(--sage);
  }

  /* Success state */
  .signup-form.success .form-group,
  .signup-form.success .btn {
    display: none;
  }

  .signup-form.success .signup-note {
    font-size: 1.125rem;
    color: var(--sage);
    font-weight: 500;
  }
</style>

<script>
  const SUPABASE_URL = 'https://hlvsukzomtapqjkyncyd.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhsdnN1a3pvbXRhcHFqa3luY3lkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczNzQyMjgsImV4cCI6MjA4Mjk1MDIyOH0.yGZZ60pASf38rp1Ma4F9dImo50aUlvjyQSUhOsB1sSw';

  const form = document.getElementById('signup-form') as HTMLFormElement;
  const message = document.getElementById('form-message') as HTMLElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const email = formData.get('email') as string;
    const isProfessional = formData.get('professional') === 'on';

    try {
      const response = await fetch(`${SUPABASE_URL}/rest/v1/waitlist`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'apikey': SUPABASE_ANON_KEY,
          'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
          'Prefer': 'return=minimal',
        },
        body: JSON.stringify({ email, is_professional: isProfessional }),
      });

      if (response.ok || response.status === 201) {
        form.classList.add('success');
        message.innerHTML = "You're on the list! We'll be in touch soon.";
      } else if (response.status === 409) {
        form.classList.add('success');
        message.innerHTML = "You're already on the list! We'll be in touch soon.";
      } else {
        message.innerHTML = '<span style="color: var(--brown);">Something went wrong. Please try again.</span>';
      }
    } catch (error) {
      message.innerHTML = '<span style="color: var(--brown);">Something went wrong. Please try again.</span>';
    }
  });
</script>
